# Railway éƒ¨ç½²æŒ‡å—å’Œæ­¥é©Ÿ

# Railway ä¸Šéƒ¨ç½² MLX OCR æ‡‰ç”¨

## ğŸ“‹ å‰ç½®éœ€æ±‚

1. Railway å¸³æˆ¶ (railway.app)
2. GitHub å¸³æˆ¶ï¼ˆæ¨è–¦ç”¨æ–¼é€£çºŒéƒ¨ç½²ï¼‰
3. Git å‘½ä»¤è¡Œå·¥å…·
4. è‡³å°‘ 2GB RAM çš„è³‡æº

## ğŸš€ å¿«é€Ÿéƒ¨ç½²æ­¥é©Ÿ

### æ–¹å¼ä¸€ï¼šä½¿ç”¨ GitHub é€£çºŒéƒ¨ç½²ï¼ˆæ¨è–¦ï¼‰

#### 1. æº–å‚™ GitHub å€‰åº«

```bash
# åˆå§‹åŒ– Git å€‰åº«
git init
git add .
git commit -m "Initial commit: MLX OCR app for Railway"

# æ¨é€åˆ° GitHub
git remote add origin https://github.com/YOUR_USERNAME/mlx-ocr.git
git branch -M main
git push -u origin main
```

#### 2. åœ¨ Railway ä¸­é€£æ¥ GitHub

1. è¨ªå• [railway.app](https://railway.app)
2. ç™»éŒ„æˆ–å‰µå»ºå¸³æˆ¶
3. é»æ“Š "Create New Project"
4. é¸æ“‡ "Deploy from GitHub repo"
5. æˆæ¬Š GitHub ä¸¦é¸æ“‡ä½ çš„å€‰åº«
6. Railway æœƒè‡ªå‹•åµæ¸¬åˆ° `railway.json` é…ç½®

#### 3. è¨­å®šç’°å¢ƒè®Šæ•¸

åœ¨ Railway é …ç›®è¨­å®šä¸­æ·»åŠ ï¼š

```
PORT=5001
PYTHONUNBUFFERED=1
MLX_USE_CPU=1
```

#### 4. å•Ÿå‹•éƒ¨ç½²

- Railway æœƒè‡ªå‹•æ§‹å»º Docker æ˜ è±¡ä¸¦éƒ¨ç½²
- é¦–æ¬¡éƒ¨ç½²éœ€è¦ 5-10 åˆ†é˜

---

### æ–¹å¼äºŒï¼šä½¿ç”¨ Railway CLI æ‰‹å‹•éƒ¨ç½²

#### 1. å®‰è£ Railway CLI

```bash
# macOS
brew install railway

# å…¶ä»–ç³»çµ±
npm install -g @railway/cli
```

#### 2. åˆå§‹åŒ–ä¸¦éƒ¨ç½²

```bash
# ç™»éŒ„ Railway
railway login

# åœ¨é …ç›®ç›®éŒ„åˆå§‹åŒ–
railway init

# éƒ¨ç½²
railway up
```

#### 3. æŸ¥çœ‹éƒ¨ç½²ç‹€æ…‹

```bash
railway status
railway logs
```

---

## ğŸ“ æ‰€éœ€æ–‡ä»¶çµæ§‹

ç¢ºä¿ä½ çš„é …ç›®åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

```
project-root/
â”œâ”€â”€ app.py                 # ä½ çš„ Flask æ‡‰ç”¨
â”œâ”€â”€ requirements.txt       # Python ä¾è³´
â”œâ”€â”€ Dockerfile            # å®¹å™¨é…ç½®
â”œâ”€â”€ railway.json          # Railway éƒ¨ç½²é…ç½®
â”œâ”€â”€ .dockerignore         # Docker å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ templates/            # HTML æ¨¡æ¿
â”‚   â””â”€â”€ index.html
â””â”€â”€ static/               # éœæ…‹æ–‡ä»¶
    â”œâ”€â”€ css/
    â””â”€â”€ js/
```

---

## âš™ï¸ Railway ç‰¹å®šé…ç½®

### PORT è®Šæ•¸

Railway è‡ªå‹•åˆ†é… `PORT` ç’°å¢ƒè®Šæ•¸ã€‚ä½ çš„ app.py éœ€è¦æ”¯æ´ï¼š

```python
# åœ¨ if __name__ == '__main__': æ®µè½ä¿®æ”¹
port = int(os.environ.get('PORT', 5001))
app.run(host='0.0.0.0', port=port, debug=False, threaded=True)
```

### è³‡æºé™åˆ¶

- **å…è²»æ–¹æ¡ˆ**ï¼š512MB RAMï¼ˆCPU æ¨¡å¼é©ç”¨ï¼‰
- **æ¨è–¦æ–¹æ¡ˆ**ï¼š1-2GB RAMï¼ˆæ›´å¥½çš„ä¸¦è¡Œå‡¦ç†ï¼‰

---

## ğŸ”§ éƒ¨ç½²å¾Œæª¢æŸ¥

### 1. é©—è­‰å¥åº·ç‹€æ…‹

```bash
curl https://your-app.railway.app/api/health
```

### 2. æª¢æŸ¥æ—¥èªŒ

åœ¨ Railway Dashboard ä¸­æŸ¥çœ‹å¯¦æ™‚æ—¥èªŒ

### 3. æ¸¬è©¦ OCR åŠŸèƒ½

è¨ªå•æ‡‰ç”¨ä¸»é ä¸¦ä¸Šå‚³æ¸¬è©¦æ–‡ä»¶

---

## ğŸ’¡ æ€§èƒ½å„ªåŒ–å»ºè­°

### 1. ä¸¦è¡Œæ§åˆ¶ï¼ˆå·²åœ¨ app.py ä¸­é…ç½®ï¼‰

- æ ¹æ“š CPU æ ¸å¿ƒæ•¸è‡ªå‹•èª¿æ•´æœ€å¤§ä¸¦è¡Œ OCR æ•¸
- Railway é è¨­åˆ†é… 2-4 æ ¸å¿ƒ

### 2. å¿«å–ç­–ç•¥

- HuggingFace æ¨¡å‹å¿«å–åœ¨ `/tmp/hf_cache`
- å¾ŒçºŒéƒ¨ç½²æœƒå¾©ç”¨å¿«å–ï¼ˆå¦‚æœæœªæ¸…é™¤ï¼‰

### 3. è¶…æ™‚è¨­å®š

- OCR è™•ç†è¶…æ™‚ï¼š300 ç§’
- é©åˆ PDF å’Œè¦–é »æ‰¹æ¬¡è™•ç†

---

## ğŸ› å¸¸è¦‹å•é¡Œ

### å•é¡Œ 1ï¼šéƒ¨ç½²è¶…æ™‚

**åŸå› **ï¼šé¦–æ¬¡éƒ¨ç½²éœ€ä¸‹è¼‰ MLX å’Œæ¨¡å‹

**è§£æ±º**ï¼š
- å¢åŠ æ§‹å»ºè¶…æ™‚æ™‚é–“
- ä½¿ç”¨æ›´é«˜ç´šçš„è¨ˆç•«ï¼ˆæ›´å¤šè³‡æºï¼‰

### å•é¡Œ 2ï¼šè¨˜æ†¶é«”ä¸è¶³

**åŸå› **ï¼šä¸¦è¡Œ OCR ä»»å‹™éå¤š

**è§£æ±º**ï¼š

```python
# åœ¨ app.py ä¸­é™ä½ MAX_CONCURRENT_OCR
if CPU_COUNT <= 2:
    MAX_CONCURRENT_OCR = 1
```

### å•é¡Œ 3ï¼šæ¨¡å‹è¼‰å…¥å¤±æ•—

**æª¢æŸ¥**ï¼š
- Railway æ—¥èªŒä¸­æ˜¯å¦æœ‰ HuggingFace é€£ç·šéŒ¯èª¤
- ç¢ºèª `MLX_USE_CPU` ç’°å¢ƒè®Šæ•¸å·²è¨­å®š

---

## ğŸ“Š ç›£æ§èˆ‡ç¶­è­·

### æŸ¥çœ‹å¯¦æ™‚ç›£æ§

1. è¨ªå• Railway Dashboard
2. é¸æ“‡ä½ çš„é …ç›®
3. æŸ¥çœ‹ CPUã€è¨˜æ†¶é«”ã€ç£ç¢Ÿä½¿ç”¨æƒ…æ³

### è‡ªå‹•é‡å•Ÿç­–ç•¥

å·²åœ¨ `railway.json` ä¸­é…ç½®ï¼š
- æ•…éšœæ™‚è‡ªå‹•é‡å•Ÿï¼ˆæœ€å¤š 5 æ¬¡ï¼‰
- å¥åº·æª¢æŸ¥æ¯ 30 ç§’é‹è¡Œä¸€æ¬¡

---

## ğŸ” å®‰å…¨å»ºè­°

1. **API èªè­‰**ï¼šç‚ºç”Ÿç”¢ç’°å¢ƒæ·»åŠ  API é‡‘é‘°é©—è­‰
2. **æª”æ¡ˆä¸Šå‚³é™åˆ¶**ï¼šå·²é™åˆ¶ç‚º 32MB
3. **ç’°å¢ƒè®Šæ•¸**ï¼šåœ¨ Railway ç§˜å¯†ç®¡ç†ä¸­å„²å­˜æ•æ„Ÿè³‡è¨Š

---

## ğŸ“ æ”¯æŒèˆ‡èª¿è©¦

### æŸ¥çœ‹è©³ç´°æ—¥èªŒ

```bash
railway logs --follow
```

### é ç«¯åŸ·è¡Œå‘½ä»¤

```bash
railway shell

# åœ¨å®¹å™¨ä¸­åŸ·è¡Œ Python
python -c "import mlx; print(mlx.__version__)"
```

### éƒ¨ç½²çµ±è¨ˆ

- **é¦–æ¬¡éƒ¨ç½²æ™‚é–“**ï¼š5-10 åˆ†é˜
- **å¾ŒçºŒéƒ¨ç½²**ï¼š2-5 åˆ†é˜ï¼ˆå¿«å–å¾©ç”¨ï¼‰
- **æ¨¡å‹ä¸‹è¼‰**ï¼š~3GBï¼ˆä¸€æ¬¡æ€§ï¼‰

---

## âœ… éƒ¨ç½²å®Œæˆæª¢æŸ¥æ¸…å–®

- [ ] æ‰€æœ‰æ–‡ä»¶å·²ä¸Šå‚³åˆ° GitHub
- [ ] PORT ç’°å¢ƒè®Šæ•¸å·²è¨­å®š
- [ ] Dockerfile å’Œ railway.json å·²åŒ…å«
- [ ] éƒ¨ç½²æ—¥èªŒä¸­ç„¡éŒ¯èª¤
- [ ] `/api/health` ç«¯é»è¿”å› 200
- [ ] å¯ä»¥ä¸Šå‚³æ¸¬è©¦æª”æ¡ˆ
- [ ] OCR åŠŸèƒ½æ­£å¸¸é‹è¡Œ

