# 🚀 MLX DeepSeek-OCR 安裝與啟用指南

## 📋 安裝步驟（4大步驟）

### 步驟 1️⃣：環境準備
```bash
# 檢查 Python 版本（需要 3.11+）
python3 --version
```

**要求：**
- ✅ macOS（Apple Silicon 推薦）
- ✅ Python 3.11 或更高版本
- ✅ 至少 4GB 可用記憶體

---

### 步驟 2️⃣：進入項目目錄並創建虛擬環境
```bash
# 進入項目目錄
cd /Users/jianjunneng/1118TESTinsatll/FLASKAPP

# 創建虛擬環境（如果不存在）
python3 -m venv venv

# 激活虛擬環境
source venv/bin/activate
```

**提示：** 激活成功後，終端提示符前會顯示 `(venv)`

---

### 步驟 3️⃣：安裝依賴
```bash
# 安裝所有依賴（約需 5-10 分鐘）
pip install -r requirements.txt
```

**包含的依賴：**
- Flask（Web 框架）
- mlx-vlm（MLX Vision-Language 模型）
- Pillow（圖像處理）
- opencv-python（圖像處理）
- numpy（數值計算）
- PyMuPDF（PDF 處理）

---

### 步驟 4️⃣：驗證安裝（可選）
```bash
# 快速檢查關鍵依賴
python3 -c "import flask, mlx_vlm, cv2, numpy; print('✅ 所有依賴安裝成功')"
```

---

## 🎯 啟用應用（2種方法）

### 方法 A：使用啟動腳本（推薦）⭐

```bash
# 確保在項目目錄
cd /Users/jianjunneng/1118TESTinsatll/FLASKAPP

# 使用啟動腳本（自動處理端口衝突）
./start.sh
```

**優點：**
- ✅ 自動檢測並使用可用端口
- ✅ 自動處理虛擬環境
- ✅ 自動檢查依賴

---

### 方法 B：手動啟動

```bash
# 1. 進入項目目錄
cd /Users/jianjunneng/1118TESTinsatll/FLASKAPP

# 2. 激活虛擬環境
source venv/bin/activate

# 3. 啟動應用
python3 app.py
```

---

## ✅ 啟動成功標誌

看到以下輸出表示啟動成功：

```
Starting MLX DeepSeek-OCR Web Application...
Note: Model will be loaded on first OCR request
💡 使用 POST /api/unload-model 可以手動釋放模型記憶體
 * Serving Flask app 'app'
 * Debug mode: on
 * Running on http://0.0.0.0:5000
 * Running on http://127.0.0.1:5000
```

---

## 🌐 訪問應用

啟動成功後，在瀏覽器訪問：

- **http://localhost:5000** （預設端口）
- **http://localhost:5001** （如果 5000 被占用）

---

## 🛑 停止應用

在運行應用的終端按：**`Ctrl + C`**

應用會自動清理資源並退出。

---

## 📊 快速檢查清單

- [ ] Python 3.11+ 已安裝
- [ ] 已進入項目目錄
- [ ] 虛擬環境已創建並激活
- [ ] 依賴已安裝完成
- [ ] 應用已成功啟動
- [ ] 瀏覽器可以訪問 http://localhost:5000

---

## 💡 重要提示

### 首次使用
- ⏳ 首次上傳圖片時會自動下載模型（~800MB）
- ⏳ 需要等待 5-15 分鐘（視網路速度而定）
- 📁 模型會下載到 `~/.cache/huggingface/hub/`

### 記憶體需求
- 💾 模型加載後占用約 2-3GB 記憶體
- 💾 確保系統有足夠可用記憶體

### 性能說明
- 🖥️ 當前配置為 CPU 模式
- ⚡ 首次加載後，後續處理會很快

---

## 🔧 常見問題

### Q1: 端口被占用怎麼辦？
**A:** 使用 `./start.sh` 腳本會自動檢測並使用備用端口（5001），並顯示正確的訪問地址。

### Q2: 缺少依賴怎麼辦？
**A:** 重新執行安裝步驟：
```bash
source venv/bin/activate
pip install -r requirements.txt
```

### Q3: Python 版本不對？
**A:** 檢查版本：
```bash
python3 --version
# 需要 3.11 或更高版本
```

### Q4: 如何檢查服務是否運行？
**A:** 
```bash
curl http://localhost:5000/api/status
```

---

## 📝 完整安裝命令（一鍵執行）

```bash
# 複製以下所有命令一次性執行

cd /Users/jianjunneng/1118TESTinsatll/FLASKAPP && \
python3 -m venv venv && \
source venv/bin/activate && \
pip install -r requirements.txt && \
echo "✅ 安裝完成！現在可以執行 ./start.sh 啟動應用"
```

---

## 🎯 快速啟動（安裝完成後）

```bash
# 每次使用只需執行：
cd /Users/jianjunneng/1118TESTinsatll/FLASKAPP
./start.sh
```

就是這麼簡單！🚀

