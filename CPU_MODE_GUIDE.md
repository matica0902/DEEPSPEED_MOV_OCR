# CPU æ¨¡å¼è¿è¡ŒæŒ‡å—

## âœ… ç¡®è®¤ï¼šæ²¡æœ‰ GPU ä¹Ÿå¯ä»¥è¿è¡Œ

**æ˜¯çš„ï¼Œå³ä½¿æ²¡æœ‰ GPUï¼ˆMetalï¼‰ï¼Œåº”ç”¨ä»ç„¶å¯ä»¥æ­£å¸¸è¿è¡Œï¼**

MLX æ¡†æ¶ä¼šè‡ªåŠ¨å›é€€åˆ° CPU æ¨¡å¼ï¼Œä¸ä¼šé˜»æ­¢åº”ç”¨å¯åŠ¨æˆ–æ‰§è¡Œã€‚

---

## ğŸ” ä»£ç éªŒè¯

### 1. å¯åŠ¨æ—¶çš„æ£€æŸ¥ï¼ˆapp.py:570ï¼‰

```python
def preload_model_main_process():
    print("ğŸ”§ Setting model preloaded status for main process...")
    try:
        if not mx.metal.is_available():
            print("WARNING: Metal is not available, MLX might not perform well.")
        
        model_loaded_status.value = True  # â† ä»ç„¶è®¾ç½®ä¸º True
        print("âœ… Model preloaded status set successfully for main process.")
        return True  # â† ä»ç„¶è¿”å› Trueï¼Œä¸ä¼šé˜»æ­¢å¯åŠ¨
    except Exception as e:
        print(f"âŒ Failed to set model preloaded status: {e}")
        return False
```

**å…³é”®ç‚¹ï¼š**
- âœ… åªæ˜¯æ‰“å°è­¦å‘Šï¼Œä¸ä¼šæŠ›å‡ºå¼‚å¸¸
- âœ… ä»ç„¶è®¾ç½® `model_loaded_status.value = True`
- âœ… ä»ç„¶è¿”å› `True`ï¼Œåº”ç”¨ä¼šæ­£å¸¸å¯åŠ¨

### 2. æ¨¡å‹åŠ è½½ï¼ˆapp.py:430ï¼‰

```python
def _load_model_for_subprocess():
    # ...
    try:
        model_path = "mlx-community/DeepSeek-OCR-8bit"
        _model_instance, _processor_instance = load(model_path)  # â† MLX è‡ªåŠ¨å›é€€åˆ° CPU
        print(f"[{os.getpid()}] ğŸ”Š Metal available: {mx.metal.is_available()}")
        return True
    except Exception as e:
        # åªæœ‰çœŸæ­£çš„é”™è¯¯æ‰ä¼šå¤±è´¥ï¼ˆå¦‚æ¨¡å‹æ–‡ä»¶ä¸å­˜åœ¨ï¼‰
        return False
```

**å…³é”®ç‚¹ï¼š**
- âœ… MLX çš„ `load()` å‡½æ•°åœ¨ Metal ä¸å¯ç”¨æ—¶ä¼šè‡ªåŠ¨ä½¿ç”¨ CPU
- âœ… ä¸ä¼šå› ä¸º GPU ä¸å¯ç”¨è€ŒæŠ›å‡ºå¼‚å¸¸
- âœ… æ¨¡å‹ä»ç„¶å¯ä»¥æ­£å¸¸åŠ è½½å’Œè¿è¡Œ

---

## ğŸ“Š MLX è‡ªåŠ¨å›é€€æœºåˆ¶

### MLX æ¡†æ¶çš„è¡Œä¸ºï¼š

1. **è‡ªåŠ¨æ£€æµ‹è®¾å¤‡ï¼š**
   - é¦–å…ˆå°è¯•ä½¿ç”¨ Metalï¼ˆGPUï¼‰
   - å¦‚æœ Metal ä¸å¯ç”¨ï¼Œè‡ªåŠ¨å›é€€åˆ° CPU
   - æ— éœ€æ‰‹åŠ¨é…ç½®

2. **é€æ˜å›é€€ï¼š**
   - ä»£ç æ— éœ€ä¿®æ”¹
   - ä¸ä¼šæŠ›å‡ºå¼‚å¸¸
   - åªæ˜¯æ€§èƒ½ä¼šå˜æ…¢

3. **è®¾å¤‡é€‰æ‹©é€»è¾‘ï¼š**
   ```python
   # MLX å†…éƒ¨é€»è¾‘ï¼ˆç®€åŒ–ç‰ˆï¼‰
   if mx.metal.is_available():
       device = mx.gpu  # ä½¿ç”¨ GPU
   else:
       device = mx.cpu  # è‡ªåŠ¨å›é€€åˆ° CPU
   ```

---

## âš ï¸ æ€§èƒ½å·®å¼‚

### GPUï¼ˆMetalï¼‰æ¨¡å¼ï¼š
- âœ… OCR å¤„ç†é€Ÿåº¦ï¼š**15-30 ç§’/é¡µ**
- âœ… GPU ä½¿ç”¨ç‡ï¼š60-80%
- âœ… CPU ä½¿ç”¨ç‡ï¼š20-40%

### CPU æ¨¡å¼ï¼š
- âš ï¸ OCR å¤„ç†é€Ÿåº¦ï¼š**60-120 ç§’/é¡µ**ï¼ˆæ…¢ 3-5 å€ï¼‰
- âš ï¸ GPU ä½¿ç”¨ç‡ï¼š0%
- âš ï¸ CPU ä½¿ç”¨ç‡ï¼š80-100%

**æ€§èƒ½å¯¹æ¯”ï¼š**
| æ¨¡å¼ | å¤„ç†æ—¶é—´ | ç›¸å¯¹é€Ÿåº¦ |
|------|---------|---------|
| GPU (Metal) | 15-30ç§’/é¡µ | 1xï¼ˆåŸºå‡†ï¼‰|
| CPU | 60-120ç§’/é¡µ | 3-5x æ…¢ |

---

## ğŸ§ª å¦‚ä½•éªŒè¯ CPU æ¨¡å¼

### æ–¹æ³• 1ï¼šæŸ¥çœ‹å¯åŠ¨æ—¥å¿—

å¯åŠ¨åº”ç”¨æ—¶ï¼ŒæŸ¥æ‰¾ä»¥ä¸‹è¾“å‡ºï¼š

**æœ‰ GPUï¼š**
```
ğŸ”§ Setting model preloaded status for main process...
âœ… Model preloaded status set successfully for main process.
[{pid}] ğŸ”Š Metal available: True
```

**æ—  GPUï¼ˆCPU æ¨¡å¼ï¼‰ï¼š**
```
ğŸ”§ Setting model preloaded status for main process...
WARNING: Metal is not available, MLX might not perform well.
âœ… Model preloaded status set successfully for main process.
[{pid}] ğŸ”Š Metal available: False
```

### æ–¹æ³• 2ï¼šè¿è¡Œ GPU æ£€æŸ¥è„šæœ¬

```bash
python check_gpu.py
```

**CPU æ¨¡å¼è¾“å‡ºç¤ºä¾‹ï¼š**
```
Metal å¯ç”¨: âŒ å¦
é»˜è®¤è®¾å¤‡: cpu
âš ï¸  è­¦å‘Š: Metal ä¸å¯ç”¨ï¼ŒMLX å°†ä½¿ç”¨ CPU
```

### æ–¹æ³• 3ï¼šè§‚å¯Ÿå¤„ç†æ—¶é—´

- **GPU æ¨¡å¼ï¼š** 15-30 ç§’/é¡µ
- **CPU æ¨¡å¼ï¼š** 60-120 ç§’/é¡µ

å¦‚æœå¤„ç†æ—¶é—´è¶…è¿‡ 60 ç§’/é¡µï¼Œå¾ˆå¯èƒ½åœ¨ä½¿ç”¨ CPU æ¨¡å¼ã€‚

### æ–¹æ³• 4ï¼šActivity Monitor

1. æ‰“å¼€ **Activity Monitor**ï¼ˆæ´»åŠ¨ç›‘è§†å™¨ï¼‰
2. è¿è¡Œ OCR ä»»åŠ¡
3. æŸ¥çœ‹ï¼š
   - **GPU æ ‡ç­¾é¡µï¼š** å¦‚æœä½¿ç”¨ç‡ä¸º 0%ï¼Œè¯´æ˜æ˜¯ CPU æ¨¡å¼
   - **CPU æ ‡ç­¾é¡µï¼š** CPU æ¨¡å¼æ—¶ä½¿ç”¨ç‡ä¼šå¾ˆé«˜ï¼ˆ80-100%ï¼‰

---

## ğŸ”§ å¸¸è§æƒ…å†µ

### æƒ…å†µ 1ï¼šé Apple Silicon Mac

**é—®é¢˜ï¼š** Intel Mac æˆ–é Mac ç³»ç»Ÿ

**ç»“æœï¼š**
- âœ… åº”ç”¨å¯ä»¥è¿è¡Œ
- âš ï¸ è‡ªåŠ¨ä½¿ç”¨ CPU æ¨¡å¼
- âš ï¸ æ€§èƒ½è¾ƒæ…¢ï¼ˆ60-120ç§’/é¡µï¼‰

**è§£å†³æ–¹æ¡ˆï¼š**
- è¿™æ˜¯æ­£å¸¸çš„ï¼ŒMLX ä¼šè‡ªåŠ¨å¤„ç†
- å»ºè®®ä½¿ç”¨ Apple Silicon Macï¼ˆM1/M2/M3/M4ï¼‰ä»¥è·å¾—æœ€ä½³æ€§èƒ½

### æƒ…å†µ 2ï¼šmacOS ç‰ˆæœ¬è¿‡ä½

**é—®é¢˜ï¼š** macOS ç‰ˆæœ¬ < 13.0

**ç»“æœï¼š**
- âœ… åº”ç”¨å¯ä»¥è¿è¡Œ
- âš ï¸ Metal å¯èƒ½ä¸å¯ç”¨
- âš ï¸ è‡ªåŠ¨ä½¿ç”¨ CPU æ¨¡å¼

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ£€æŸ¥ macOS ç‰ˆæœ¬
sw_vers

# å¦‚æœç‰ˆæœ¬è¿‡ä½ï¼Œå‡çº§åˆ° macOS 13.0+
```

### æƒ…å†µ 3ï¼šMLX å®‰è£…é—®é¢˜

**é—®é¢˜ï¼š** MLX æœªæ­£ç¡®å®‰è£…æˆ–ç‰ˆæœ¬ä¸å…¼å®¹

**ç»“æœï¼š**
- âœ… åº”ç”¨å¯ä»¥è¿è¡Œ
- âš ï¸ Metal å¯èƒ½ä¸å¯ç”¨
- âš ï¸ è‡ªåŠ¨ä½¿ç”¨ CPU æ¨¡å¼

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# é‡æ–°å®‰è£… MLX
pip uninstall mlx mlx-vlm
pip install mlx mlx-vlm

# éªŒè¯å®‰è£…
python -c "import mlx.core as mx; print(f'Metal available: {mx.metal.is_available()}')"
```

---

## âœ… æ€»ç»“

### å…³é”®è¦ç‚¹ï¼š

1. **âœ… å¯ä»¥è¿è¡Œï¼š** æ²¡æœ‰ GPU æ—¶åº”ç”¨ä»ç„¶å¯ä»¥æ­£å¸¸è¿è¡Œ
2. **âœ… è‡ªåŠ¨å›é€€ï¼š** MLX ä¼šè‡ªåŠ¨ä½¿ç”¨ CPUï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®
3. **âš ï¸ æ€§èƒ½è¾ƒæ…¢ï¼š** CPU æ¨¡å¼æ¯” GPU æ¨¡å¼æ…¢ 3-5 å€
4. **âœ… æ— éœ€ä¿®æ”¹ä»£ç ï¼š** ä»£ç ä¼šè‡ªåŠ¨é€‚åº” CPU/GPU æ¨¡å¼

### ä½•æ—¶éœ€è¦æ‹…å¿ƒï¼š

- âŒ **ä¸éœ€è¦æ‹…å¿ƒï¼š** åº”ç”¨æ— æ³•å¯åŠ¨ï¼ˆMLX ä¼šè‡ªåŠ¨å›é€€ï¼‰
- âš ï¸ **éœ€è¦å…³æ³¨ï¼š** å¤„ç†æ—¶é—´è¿‡é•¿ï¼ˆå¯èƒ½æ˜¯ CPU æ¨¡å¼ï¼‰
- âš ï¸ **éœ€è¦æ£€æŸ¥ï¼š** æ€§èƒ½å¼‚å¸¸ï¼ˆæ£€æŸ¥ GPU æ˜¯å¦å¯ç”¨ï¼‰

### æœ€ä½³å®è·µï¼š

1. **å¼€å‘ç¯å¢ƒï¼š** CPU æ¨¡å¼å¯ä»¥ç”¨äºå¼€å‘å’Œæµ‹è¯•
2. **ç”Ÿäº§ç¯å¢ƒï¼š** å»ºè®®ä½¿ç”¨ Apple Silicon Mac ä»¥è·å¾—æœ€ä½³æ€§èƒ½
3. **ç›‘æ§æ€§èƒ½ï¼š** è®°å½•å¤„ç†æ—¶é—´ï¼Œå¼‚å¸¸æ—¶æ£€æŸ¥ GPU çŠ¶æ€

---

## ğŸ“ ç›¸å…³æ–‡ä»¶

- `check_gpu.py` - GPU éªŒè¯è„šæœ¬
- `GPU_VERIFICATION_GUIDE.md` - GPU éªŒè¯æŒ‡å—
- `GPU_CPU_ANALYSIS.md` - GPU/CPU åˆ†ææŠ¥å‘Š



